
		<head>
			<style type="text/css" media="screen">
				body,html{font-family:var(--markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, "Ubuntu", "Droid Sans", sans-serif);font-size:var(--markdown-font-size,14px);padding:0 26px;line-height:var(--markdown-line-height,22px);word-wrap:break-word}body{padding-top:1em}h1,h2,h3,h4,h5,h6,ol,p,pre,ul{margin-top:0}h2,h3,h4,h5,h6{font-weight:400;margin-bottom:.2em}img{max-width:100%;max-height:100%}a{text-decoration:none}a:hover{text-decoration:underline}a:focus,input:focus,select:focus,textarea:focus{outline:1px solid -webkit-focus-ring-color;outline-offset:-1px}p{margin-bottom:.7em}ol,ul{margin-bottom:.7em}hr{border:0;height:2px;border-bottom:2px solid}h1{padding-bottom:.3em;line-height:1.2;border-bottom-width:1px;border-bottom-style:solid;font-weight:400}table{border-collapse:collapse}th{text-align:left;border-bottom:1px solid}td,th{padding:5px 10px}table>tbody>tr+tr>td{border-top:1px solid}blockquote{margin:0 7px 0 5px;padding:0 16px 0 10px;border-left-width:5px;border-left-style:solid}code{font-family:var(--vscode-editor-font-family, "SF Mono", Monaco, Menlo, Consolas, "Ubuntu Mono", "Liberation Mono", "DejaVu Sans Mono", "Courier New", monospace);font-size:1em;line-height:1.357em}body.wordWrap pre{white-space:pre-wrap}pre.hljs code>div,pre:not(.hljs){padding:16px;border-radius:3px;overflow:auto}pre code{color:var(--vscode-editor-foreground);tab-size:4}
			</style>
		</head>
		<body>
			<h1 id="tp--quarkus-microservices--foodexpress">TP â€” Quarkus Microservices : <strong>FoodExpress</strong></h1>
<h2 id="plateforme-de-livraison-de-repas-en-microservices">Plateforme de livraison de repas en microservices</h2>
<hr>
<h2 id="contexte-gÃ©nÃ©ral">Contexte gÃ©nÃ©ral</h2>
<p>Vous Ãªtes dÃ©veloppeurÂ·se au sein de la startup <strong>FoodExpress</strong>. L&#39;entreprise souhaite construire une plateforme de livraison de repas basÃ©e sur une <strong>architecture microservices</strong> avec <strong>Quarkus</strong>.</p>
<p>Le systÃ¨me est composÃ© de <strong>4 microservices</strong> qui collaborent via des appels REST synchrones :</p>
<table>
<thead>
<tr>
<th>Microservice</th>
<th>Port</th>
<th>ResponsabilitÃ©</th>
</tr>
</thead>
<tbody><tr>
<td><strong>customer-service</strong></td>
<td>8081</td>
<td>Gestion des clients</td>
</tr>
<tr>
<td><strong>restaurant-service</strong></td>
<td>8082</td>
<td>Gestion des restaurants et de leurs menus</td>
</tr>
<tr>
<td><strong>order-service</strong></td>
<td>8083</td>
<td>Gestion des commandes</td>
</tr>
<tr>
<td><strong>delivery-service</strong></td>
<td>8084</td>
<td>Gestion des livraisons et des livreurs</td>
</tr>
</tbody></table>
<h3 id="schÃ©ma-darchitecture">SchÃ©ma d&#39;architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   customer   â”‚       â”‚   restaurant      â”‚
â”‚   service    â”‚       â”‚   service         â”‚
â”‚   :8081      â”‚       â”‚   :8082           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                         â”‚
       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
       â””â”€â”€â”€â–ºâ”‚  order-service â”‚â—„â”€â”€â”˜
            â”‚     :8083      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   delivery     â”‚
            â”‚   service      â”‚
            â”‚   :8084        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Flux principal :</strong></p>
<ol>
<li>Un <strong>client</strong> passe une commande en rÃ©fÃ©renÃ§ant un <strong>restaurant</strong> et des <strong>plats</strong></li>
<li>Le <strong>order-service</strong> vÃ©rifie l&#39;existence du client (appel REST â†’ customer-service) et du restaurant/plats (appel REST â†’ restaurant-service)</li>
<li>Une fois la commande validÃ©e, le <strong>order-service</strong> dÃ©clenche la crÃ©ation d&#39;une livraison (appel REST â†’ delivery-service)</li>
<li>Le <strong>delivery-service</strong> assigne un livreur disponible et suit l&#39;Ã©tat de la livraison</li>
</ol>
<hr>
<h2 id="objectifs-pÃ©dagogiques">Objectifs pÃ©dagogiques</h2>
<p>Ce TP couvre les concepts suivants :</p>
<table>
<thead>
<tr>
<th>Module</th>
<th>Concepts</th>
<th>Application dans le TP</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>Introduction &amp; Philosophie</td>
<td>Comprendre le mode dev, live reload, build natif, supersonic/subatomic</td>
</tr>
<tr>
<td>02</td>
<td>Installation &amp; Premier Projet</td>
<td>CrÃ©er 4 projets Quarkus avec les bonnes extensions</td>
</tr>
<tr>
<td>03</td>
<td>CDI â€” Injection de dÃ©pendances</td>
<td>Services mÃ©tier, clients REST, patterns d&#39;injection</td>
</tr>
<tr>
<td>04</td>
<td>JAX-RS â€” API REST</td>
<td>Endpoints CRUD, communication inter-services, REST Client</td>
</tr>
<tr>
<td>05</td>
<td>Hibernate ORM avec Panache</td>
<td>EntitÃ©s, repositories, Active Record vs Repository Pattern</td>
</tr>
<tr>
<td>06</td>
<td>Validation &amp; Gestion d&#39;erreur</td>
<td>Bean Validation, ExceptionMapper, gestion des erreurs inter-services</td>
</tr>
</tbody></table>
<hr>
<h2 id="prÃ©requis">PrÃ©requis</h2>
<ul>
<li>JDK 17+</li>
<li>Maven 3.9+ ou Quarkus CLI</li>
<li>Un IDE (IntelliJ IDEA recommandÃ©)</li>
<li>Docker (pour les bases de donnÃ©es)</li>
<li>Un client HTTP (curl, Postman, ou extension VS Code REST Client)</li>
</ul>
<hr>
<h2 id="partie-1--introduction--crÃ©ation-des-projets">Partie 1 â€” Introduction &amp; CrÃ©ation des projets</h2>
<h3 id="11--crÃ©ation-des-4-microservices">1.1 â€” CrÃ©ation des 4 microservices</h3>
<p>CrÃ©ez un rÃ©pertoire parent <code>foodexpress/</code> contenant les 4 projets.</p>
<p>Pour chaque microservice, gÃ©nÃ©rez un projet Quarkus avec les extensions appropriÃ©es.</p>
<p><strong>Extensions communes Ã  tous les services :</strong></p>
<ul>
<li><code>quarkus-resteasy-reactive-jackson</code></li>
<li><code>quarkus-hibernate-orm-panache</code></li>
<li><code>quarkus-jdbc-postgresql</code></li>
<li><code>quarkus-hibernate-validator</code></li>
<li><code>quarkus-smallrye-openapi</code></li>
</ul>
<p><strong>Extension supplÃ©mentaire pour <code>order-service</code> et <code>delivery-service</code> :</strong></p>
<ul>
<li><code>quarkus-rest-client-reactive-jackson</code> (pour les appels inter-services)</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>Travail demandÃ© :</strong></p>
<ol>
<li>GÃ©nÃ©rez les 4 projets avec la commande <code>quarkus create app</code> ou via <a href="https://code.quarkus.io">code.quarkus.io</a></li>
<li>Configurez le <code>application.properties</code> de chaque service avec :<ul>
<li>Le port HTTP dÃ©diÃ© (<code>quarkus.http.port</code>)</li>
<li>La datasource PostgreSQL (une base distincte par service)</li>
<li><code>quarkus.hibernate-orm.database.generation=drop-and-create</code> (pour le dÃ©veloppement)</li>
</ul>
</li>
<li>Lancez chaque service en mode dev (<code>quarkus dev</code>) et vÃ©rifiez que la Dev UI est accessible</li>
<li>Consultez le Swagger UI de chaque service (<code>/q/swagger-ui</code>)</li>
</ol>
</blockquote>
<p><strong>Docker Compose</strong> pour les bases de donnÃ©es (fichier Ã  placer Ã  la racine <code>foodexpress/</code>) :</p>
<pre><code class="language-yaml"># CrÃ©ez le fichier docker-compose.yml avec :
# - 4 instances PostgreSQL (ports 5441, 5442, 5443, 5444)
# - Un rÃ©seau partagÃ©
# - Des volumes persistants
</code></pre>
<hr>
<h2 id="partie-2--cdi--injection-de-dÃ©pendances">Partie 2 â€” CDI : Injection de dÃ©pendances</h2>
<h3 id="21--architecture-en-couches">2.1 â€” Architecture en couches</h3>
<p>Chaque microservice doit respecter l&#39;architecture suivante :</p>
<pre><code>src/main/java/com/foodexpress/{service}/
â”œâ”€â”€ entity/          # EntitÃ©s JPA
â”œâ”€â”€ repository/      # Repositories Panache (si pattern Repository)
â”œâ”€â”€ service/         # Logique mÃ©tier (beans CDI)
â”œâ”€â”€ resource/        # Endpoints JAX-RS
â”œâ”€â”€ client/          # Interfaces REST Client (si appels inter-services)
â”œâ”€â”€ dto/             # Objets de transfert (requÃªtes/rÃ©ponses)
â””â”€â”€ exception/       # Exceptions mÃ©tier + ExceptionMappers
</code></pre>
<h3 id="22--implÃ©mentation-des-services-cdi">2.2 â€” ImplÃ©mentation des services CDI</h3>
<blockquote>
<p>ğŸ“Œ <strong>Travail demandÃ© pour chaque microservice :</strong></p>
<ol>
<li>CrÃ©ez une classe <strong>Service</strong> annotÃ©e <code>@ApplicationScoped</code> qui contient la logique mÃ©tier</li>
<li>Injectez les dÃ©pendances nÃ©cessaires via <code>@Inject</code></li>
<li>Pour <code>order-service</code> : injectez les REST Clients vers <code>customer-service</code> et <code>restaurant-service</code></li>
<li>Pour <code>delivery-service</code> : crÃ©ez un service <code>DeliveryAssignmentService</code> qui sÃ©lectionne un livreur disponible</li>
</ol>
</blockquote>
<h3 id="23--exercices-cdi-spÃ©cifiques">2.3 â€” Exercices CDI spÃ©cifiques</h3>
<blockquote>
<p>ğŸ“Œ <strong>Exercices :</strong></p>
<p><strong>a)</strong> Dans <code>restaurant-service</code>, crÃ©ez une interface <code>MenuFormatter</code> avec deux implÃ©mentations :</p>
<ul>
<li><code>SimpleMenuFormatter</code> â€” retourne le menu en texte brut</li>
<li><code>DetailedMenuFormatter</code> â€” retourne le menu avec descriptions et allergÃ¨nes</li>
</ul>
<p>Utilisez le qualifier <code>@Named</code> ou un <strong>qualifier personnalisÃ©</strong> <code>@MenuFormat(type=SIMPLE|DETAILED)</code> pour choisir l&#39;implÃ©mentation Ã  injecter.</p>
<p><strong>b)</strong> Dans <code>delivery-service</code>, crÃ©ez un bean <code>@Dependent</code> <code>DeliveryTracker</code> qui encapsule l&#39;Ã©tat d&#39;une livraison en cours. Expliquez dans <code>REPONSES.md</code> pourquoi <code>@Dependent</code> est plus appropriÃ© que <code>@ApplicationScoped</code> ici.</p>
<p><strong>c)</strong> Dans <code>order-service</code>, crÃ©ez un <strong>producer method</strong> (<code>@Produces</code>) qui fournit un objet de configuration <code>OrderConfig</code> contenant les paramÃ¨tres mÃ©tier (montant minimum de commande, rayon de livraison max, etc.) lus depuis <code>application.properties</code> via <code>@ConfigProperty</code>.</p>
</blockquote>
<hr>
<h2 id="partie-3--jax-rs--api-rest--communication-inter-services">Partie 3 â€” JAX-RS : API REST &amp; Communication inter-services</h2>
<h3 id="31--endpoints-Ã -implÃ©menter">3.1 â€” Endpoints Ã  implÃ©menter</h3>
<h4 id="customer-service-port-8081"><strong>customer-service</strong> (port 8081)</h4>
<table>
<thead>
<tr>
<th>MÃ©thode</th>
<th>URI</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>POST</code></td>
<td><code>/api/customers</code></td>
<td>CrÃ©er un client</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/customers</code></td>
<td>Lister tous les clients</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/customers/{id}</code></td>
<td>RÃ©cupÃ©rer un client par ID</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td><code>/api/customers/{id}</code></td>
<td>Mettre Ã  jour un client</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td><code>/api/customers/{id}</code></td>
<td>Supprimer un client</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/customers/{id}/exists</code></td>
<td>VÃ©rifier l&#39;existence (retourne <code>boolean</code>)</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/customers/search?city={city}</code></td>
<td>Rechercher par ville</td>
</tr>
</tbody></table>
<h4 id="restaurant-service-port-8082"><strong>restaurant-service</strong> (port 8082)</h4>
<table>
<thead>
<tr>
<th>MÃ©thode</th>
<th>URI</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>POST</code></td>
<td><code>/api/restaurants</code></td>
<td>CrÃ©er un restaurant</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/restaurants</code></td>
<td>Lister tous les restaurants</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/restaurants/{id}</code></td>
<td>RÃ©cupÃ©rer un restaurant avec son menu</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td><code>/api/restaurants/{id}</code></td>
<td>Mettre Ã  jour un restaurant</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td><code>/api/restaurants/{id}</code></td>
<td>Supprimer un restaurant</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/api/restaurants/{id}/dishes</code></td>
<td>Ajouter un plat au menu</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td><code>/api/restaurants/{id}/dishes/{dishId}</code></td>
<td>Retirer un plat du menu</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/restaurants/{id}/dishes/{dishId}/exists</code></td>
<td>VÃ©rifier l&#39;existence d&#39;un plat</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/restaurants/search?cuisine={type}</code></td>
<td>Rechercher par type de cuisine</td>
</tr>
</tbody></table>
<h4 id="order-service-port-8083"><strong>order-service</strong> (port 8083)</h4>
<table>
<thead>
<tr>
<th>MÃ©thode</th>
<th>URI</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>POST</code></td>
<td><code>/api/orders</code></td>
<td>CrÃ©er une commande (dÃ©clenche les vÃ©rifications + livraison)</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/orders</code></td>
<td>Lister toutes les commandes</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/orders/{id}</code></td>
<td>RÃ©cupÃ©rer une commande avec son dÃ©tail</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td><code>/api/orders/{id}/status</code></td>
<td>Mettre Ã  jour le statut d&#39;une commande</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/orders/customer/{customerId}</code></td>
<td>Commandes d&#39;un client</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td><code>/api/orders/{id}</code></td>
<td>Annuler une commande (si statut le permet)</td>
</tr>
</tbody></table>
<h4 id="delivery-service-port-8084"><strong>delivery-service</strong> (port 8084)</h4>
<table>
<thead>
<tr>
<th>MÃ©thode</th>
<th>URI</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>POST</code></td>
<td><code>/api/deliveries</code></td>
<td>CrÃ©er une livraison (appelÃ© par order-service)</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/deliveries/{id}</code></td>
<td>RÃ©cupÃ©rer une livraison</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td><code>/api/deliveries/{id}/status</code></td>
<td>Mettre Ã  jour le statut (ASSIGNED â†’ PICKED_UP â†’ DELIVERED)</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/deliveries/driver/{driverId}</code></td>
<td>Livraisons d&#39;un livreur</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/api/drivers</code></td>
<td>Enregistrer un livreur</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td><code>/api/drivers/{id}/availability</code></td>
<td>Changer la disponibilitÃ© d&#39;un livreur</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/api/drivers/available</code></td>
<td>Lister les livreurs disponibles</td>
</tr>
</tbody></table>
<h3 id="32--communication-inter-services-avec-rest-client">3.2 â€” Communication inter-services avec REST Client</h3>
<blockquote>
<p> <strong>Travail demandÃ© :</strong></p>
<p><strong>a)</strong> Dans <code>order-service</code>, crÃ©ez les interfaces REST Client :</p>
<pre><code class="language-java">// Exemple de structure attendue :
@Path(&quot;/api/customers&quot;)
@RegisterRestClient(configKey = &quot;customer-api&quot;)
public interface CustomerRestClient {
    // DÃ©clarez les mÃ©thodes nÃ©cessaires
}
</code></pre>
<p><strong>b)</strong> Configurez les URLs des services dans <code>application.properties</code> :</p>
<pre><code class="language-properties">quarkus.rest-client.customer-api.url=http://localhost:8081
quarkus.rest-client.restaurant-api.url=http://localhost:8082
</code></pre>
<p><strong>c)</strong> ImplÃ©mentez le flux complet de crÃ©ation de commande :</p>
<ol>
<li>Recevoir la requÃªte <code>POST /api/orders</code> avec le <code>customerId</code>, <code>restaurantId</code> et la liste des <code>dishIds</code> avec quantitÃ©s</li>
<li>VÃ©rifier que le client existe (appel Ã  <code>customer-service</code>)</li>
<li>VÃ©rifier que le restaurant et les plats existent (appels Ã  <code>restaurant-service</code>)</li>
<li>Calculer le montant total</li>
<li>Persister la commande</li>
<li>DÃ©clencher la crÃ©ation d&#39;une livraison (appel Ã  <code>delivery-service</code>)</li>
<li>Retourner la commande crÃ©Ã©e avec les informations de livraison</li>
</ol>
<p><strong>d)</strong> Dans <code>delivery-service</code>, implÃ©mentez la logique d&#39;assignation automatique d&#39;un livreur disponible lors de la crÃ©ation d&#39;une livraison.</p>
</blockquote>
<h3 id="33--exercices-jax-rs-spÃ©cifiques">3.3 â€” Exercices JAX-RS spÃ©cifiques</h3>
<blockquote>
<p> <strong>Exercices :</strong></p>
<p><strong>a)</strong> ImplÃ©mentez la <strong>pagination</strong> sur tous les endpoints de listing (<code>GET</code> collections) avec les query params <code>page</code> et <code>size</code>. Retournez un objet enveloppe contenant : <code>data</code>, <code>page</code>, <code>size</code>, <code>totalElements</code>, <code>totalPages</code>.</p>
<p><strong>b)</strong> Ajoutez des <strong>filtres</strong> sur <code>GET /api/restaurants</code> : filtrage par <code>cuisine</code>, <code>city</code>, <code>rating</code> minimum, et <code>open</code> (ouvert maintenant). Combinez les filtres dynamiquement.</p>
<p><strong>c)</strong> ImplÃ©mentez un endpoint <code>GET /api/orders/{id}/full</code> dans <code>order-service</code> qui retourne une vue agrÃ©gÃ©e contenant les dÃ©tails du client, du restaurant et de la livraison (nÃ©cessite des appels vers les 3 autres services).</p>
</blockquote>
<hr>
<h2 id="partie-4--hibernate-orm-avec-panache">Partie 4 â€” Hibernate ORM avec Panache</h2>
<h3 id="41--modÃ¨le-de-donnÃ©es">4.1 â€” ModÃ¨le de donnÃ©es</h3>
<p>ImplÃ©mentez les entitÃ©s suivantes :</p>
<h4 id="customer-service">customer-service</h4>
<pre><code>Customer
â”œâ”€â”€ id : Long (gÃ©nÃ©rÃ©)
â”œâ”€â”€ firstName : String
â”œâ”€â”€ lastName : String
â”œâ”€â”€ email : String (unique)
â”œâ”€â”€ phone : String
â”œâ”€â”€ address : String
â”œâ”€â”€ city : String
â”œâ”€â”€ zipCode : String
â”œâ”€â”€ createdAt : LocalDateTime
â””â”€â”€ active : boolean
</code></pre>
<h4 id="restaurant-service">restaurant-service</h4>
<pre><code>Restaurant                          Dish
â”œâ”€â”€ id : Long                       â”œâ”€â”€ id : Long
â”œâ”€â”€ name : String                   â”œâ”€â”€ name : String
â”œâ”€â”€ cuisine : String                â”œâ”€â”€ description : String
â”œâ”€â”€ address : String                â”œâ”€â”€ price : BigDecimal
â”œâ”€â”€ city : String                   â”œâ”€â”€ category : String (STARTER, MAIN, DESSERT, DRINK)
â”œâ”€â”€ phone : String                  â”œâ”€â”€ available : boolean
â”œâ”€â”€ rating : Double                 â”œâ”€â”€ allergens : String
â”œâ”€â”€ openingTime : LocalTime         â””â”€â”€ restaurant : Restaurant (ManyToOne)
â”œâ”€â”€ closingTime : LocalTime
â”œâ”€â”€ active : boolean
â””â”€â”€ dishes : List&lt;Dish&gt; (OneToMany)
</code></pre>
<h4 id="order-service">order-service</h4>
<pre><code>Order                               OrderItem
â”œâ”€â”€ id : Long                       â”œâ”€â”€ id : Long
â”œâ”€â”€ customerId : Long               â”œâ”€â”€ dishId : Long
â”œâ”€â”€ restaurantId : Long             â”œâ”€â”€ dishName : String
â”œâ”€â”€ status : OrderStatus            â”œâ”€â”€ unitPrice : BigDecimal
â”‚   (CREATED, CONFIRMED,            â”œâ”€â”€ quantity : int
â”‚    PREPARING, READY,              â””â”€â”€ order : Order (ManyToOne)
â”‚    PICKED_UP, DELIVERED,
â”‚    CANCELLED)
â”œâ”€â”€ totalAmount : BigDecimal
â”œâ”€â”€ deliveryAddress : String
â”œâ”€â”€ createdAt : LocalDateTime
â”œâ”€â”€ updatedAt : LocalDateTime
â””â”€â”€ items : List&lt;OrderItem&gt; (OneToMany, cascade)
</code></pre>
<h4 id="delivery-service">delivery-service</h4>
<pre><code>Delivery                            Driver
â”œâ”€â”€ id : Long                       â”œâ”€â”€ id : Long
â”œâ”€â”€ orderId : Long (unique)         â”œâ”€â”€ firstName : String
â”œâ”€â”€ driverId : Long                 â”œâ”€â”€ lastName : String
â”œâ”€â”€ status : DeliveryStatus         â”œâ”€â”€ phone : String
â”‚   (PENDING, ASSIGNED,             â”œâ”€â”€ vehicleType : String (BIKE, SCOOTER, CAR)
â”‚    PICKED_UP, IN_TRANSIT,         â”œâ”€â”€ available : boolean
â”‚    DELIVERED, FAILED)             â”œâ”€â”€ currentZone : String
â”œâ”€â”€ pickupAddress : String          â””â”€â”€ rating : Double
â”œâ”€â”€ deliveryAddress : String
â”œâ”€â”€ estimatedTime : LocalDateTime
â”œâ”€â”€ deliveredAt : LocalDateTime
â””â”€â”€ createdAt : LocalDateTime
</code></pre>
<h3 id="42--choix-du-pattern-panache">4.2 â€” Choix du pattern Panache</h3>
<blockquote>
<p> <strong>Travail demandÃ© :</strong></p>
<p><strong>a)</strong> ImplÃ©mentez <code>customer-service</code> et <code>restaurant-service</code> avec le <strong>pattern Active Record</strong> (entitÃ©s Ã©tendent <code>PanacheEntity</code>).</p>
<p><strong>b)</strong> ImplÃ©mentez <code>order-service</code> et <code>delivery-service</code> avec le <strong>pattern Repository</strong> (entitÃ©s simples + classes <code>PanacheRepository</code>).</p>
<p><strong>c)</strong> Dans <code>REPONSES.md</code>, comparez les deux approches : avantages, inconvÃ©nients, et dans quel contexte vous choisiriez l&#39;une plutÃ´t que l&#39;autre.</p>
</blockquote>
<h3 id="43--requÃªtes-panache-personnalisÃ©es">4.3 â€” RequÃªtes Panache personnalisÃ©es</h3>
<blockquote>
<p> <strong>ImplÃ©mentez les requÃªtes suivantes :</strong></p>
<p><strong>customer-service :</strong></p>
<ul>
<li>Trouver tous les clients actifs d&#39;une ville donnÃ©e</li>
<li>Rechercher un client par email</li>
<li>Compter le nombre de clients par ville</li>
</ul>
<p><strong>restaurant-service :</strong></p>
<ul>
<li>Trouver les restaurants ouverts Ã  une heure donnÃ©e</li>
<li>Trouver les restaurants par type de cuisine dans une ville</li>
<li>Lister les plats disponibles d&#39;un restaurant par catÃ©gorie</li>
<li>Trouver les restaurants ayant un rating supÃ©rieur Ã  une valeur donnÃ©e</li>
</ul>
<p><strong>order-service :</strong></p>
<ul>
<li>Trouver les commandes d&#39;un client triÃ©es par date dÃ©croissante</li>
<li>Trouver les commandes par statut</li>
<li>Calculer le montant total des commandes d&#39;un client</li>
<li>Trouver les commandes d&#39;un restaurant sur une pÃ©riode donnÃ©e</li>
</ul>
<p><strong>delivery-service :</strong></p>
<ul>
<li>Trouver les livreurs disponibles dans une zone</li>
<li>Trouver les livraisons actives (non terminÃ©es) d&#39;un livreur</li>
<li>Calculer le nombre de livraisons terminÃ©es par livreur (pour le rating)</li>
</ul>
</blockquote>
<hr>
<h2 id="partie-5--validation--gestion-derreurs">Partie 5 â€” Validation &amp; Gestion d&#39;erreurs</h2>
<h3 id="51--bean-validation">5.1 â€” Bean Validation</h3>
<blockquote>
<p> <strong>Travail demandÃ© :</strong></p>
<p>Ajoutez les contraintes de validation sur toutes les entitÃ©s et/ou DTOs :</p>
<p><strong>Customer :</strong></p>
<ul>
<li><code>firstName</code> / <code>lastName</code> : obligatoires, entre 2 et 50 caractÃ¨res</li>
<li><code>email</code> : obligatoire, format email valide, unique</li>
<li><code>phone</code> : obligatoire, pattern regex pour format tÃ©lÃ©phone</li>
<li><code>zipCode</code> : obligatoire, pattern regex 5 chiffres</li>
</ul>
<p><strong>Restaurant :</strong></p>
<ul>
<li><code>name</code> : obligatoire, entre 2 et 100 caractÃ¨res</li>
<li><code>cuisine</code> : obligatoire</li>
<li><code>phone</code> : format valide</li>
<li><code>openingTime</code> doit Ãªtre avant <code>closingTime</code></li>
</ul>
<p><strong>Dish :</strong></p>
<ul>
<li><code>name</code> : obligatoire</li>
<li><code>price</code> : obligatoire, <code>@Positive</code></li>
<li><code>category</code> : obligatoire, valeur parmi l&#39;enum autorisÃ©</li>
</ul>
<p><strong>Order :</strong></p>
<ul>
<li><code>customerId</code> / <code>restaurantId</code> : obligatoires, <code>@NotNull</code></li>
<li><code>items</code> : obligatoire, <code>@NotEmpty</code> (au moins 1 item)</li>
<li>Chaque item : <code>dishId</code> <code>@NotNull</code>, <code>quantity</code> <code>@Min(1)</code></li>
<li><code>deliveryAddress</code> : obligatoire</li>
</ul>
<p><strong>Driver :</strong></p>
<ul>
<li><code>firstName</code> / <code>lastName</code> : obligatoires</li>
<li><code>phone</code> : obligatoire, format valide</li>
<li><code>vehicleType</code> : obligatoire, valeur parmi l&#39;enum autorisÃ©</li>
</ul>
</blockquote>
<h3 id="52--validation-personnalisÃ©e">5.2 â€” Validation personnalisÃ©e</h3>
<blockquote>
<p> <strong>Exercice :</strong></p>
<p>CrÃ©ez une <strong>contrainte de validation personnalisÃ©e</strong> <code>@ValidOrderAmount</code> Ã  placer sur la classe <code>Order</code> (validation au niveau classe). Cette contrainte vÃ©rifie que :</p>
<ul>
<li>Le montant total est cohÃ©rent avec la somme des items</li>
<li>Le montant total est supÃ©rieur au minimum de commande (configurable)</li>
</ul>
<p>ImplÃ©mentez le <code>ConstraintValidator</code> correspondant.</p>
</blockquote>
<h3 id="53--gestion-derreurs-globale">5.3 â€” Gestion d&#39;erreurs globale</h3>
<blockquote>
<p> <strong>Travail demandÃ© :</strong></p>
<p><strong>a)</strong> CrÃ©ez un format d&#39;erreur standardisÃ© utilisÃ© par <strong>tous</strong> les microservices :</p>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2025-01-15T10:30:00&quot;,
  &quot;status&quot;: 404,
  &quot;error&quot;: &quot;Not Found&quot;,
  &quot;message&quot;: &quot;Customer with id 42 not found&quot;,
  &quot;path&quot;: &quot;/api/customers/42&quot;,
  &quot;service&quot;: &quot;customer-service&quot;
}
</code></pre>
<p><strong>b)</strong> CrÃ©ez les exceptions mÃ©tier suivantes et leurs <code>ExceptionMapper</code> associÃ©s :</p>
<table>
<thead>
<tr>
<th>Exception</th>
<th>Code HTTP</th>
<th>Cas d&#39;usage</th>
</tr>
</thead>
<tbody><tr>
<td><code>ResourceNotFoundException</code></td>
<td>404</td>
<td>EntitÃ© non trouvÃ©e (client, restaurant, plat, commande, livraison)</td>
</tr>
<tr>
<td><code>DuplicateResourceException</code></td>
<td>409</td>
<td>Email client dÃ©jÃ  existant, commande doublon</td>
</tr>
<tr>
<td><code>InvalidStatusTransitionException</code></td>
<td>422</td>
<td>Transition de statut invalide (ex: DELIVERED â†’ CREATED)</td>
</tr>
<tr>
<td><code>ServiceUnavailableException</code></td>
<td>503</td>
<td>Un microservice distant ne rÃ©pond pas</td>
</tr>
<tr>
<td><code>BusinessRuleException</code></td>
<td>422</td>
<td>RÃ¨gle mÃ©tier violÃ©e (montant min, restaurant fermÃ©, etc.)</td>
</tr>
</tbody></table>
<p><strong>c)</strong> CrÃ©ez un <code>ExceptionMapper</code> pour <code>ConstraintViolationException</code> qui transforme les erreurs de validation en rÃ©ponse structurÃ©e :</p>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2025-01-15T10:30:00&quot;,
  &quot;status&quot;: 400,
  &quot;error&quot;: &quot;Validation Error&quot;,
  &quot;message&quot;: &quot;La requÃªte contient des erreurs de validation&quot;,
  &quot;violations&quot;: [
    { &quot;field&quot;: &quot;email&quot;, &quot;message&quot;: &quot;must be a valid email&quot; },
    { &quot;field&quot;: &quot;firstName&quot;, &quot;message&quot;: &quot;size must be between 2 and 50&quot; }
  ],
  &quot;service&quot;: &quot;customer-service&quot;
}
</code></pre>
</blockquote>
<hr>
<h2 id="livrables-attendus">Livrables attendus</h2>
<ul>
<li>Le code source des 4 microservices dans un dÃ©pÃ´t Git</li>
<li>Le fichier <code>docker-compose.yml</code> pour les bases de donnÃ©es</li>
<li>Une collection Postman ou un fichier <code>.http</code> avec tous les appels de test</li>
<li>Un <code>README.md</code> global expliquant comment lancer le projet</li>
</ul>
<hr>
<h2 id="conseils">Conseils</h2>
<blockquote>
<ul>
<li>Commencez par implÃ©menter <code>customer-service</code> et <code>restaurant-service</code> qui sont autonomes, puis <code>order-service</code> et enfin <code>delivery-service</code></li>
<li>Utilisez le <strong>Dev Mode</strong> de Quarkus (<code>quarkus dev</code>) pour bÃ©nÃ©ficier du live reload</li>
<li>Consultez la <strong>Dev UI</strong> (<code>/q/dev-ui</code>) pour visualiser vos beans CDI, endpoints, et entitÃ©s</li>
<li>Exploitez le <strong>Swagger UI</strong> (<code>/q/swagger-ui</code>) pour tester vos endpoints pendant le dÃ©veloppement</li>
<li>N&#39;hÃ©sitez pas Ã  utiliser <code>@Transactional</code> sur vos mÃ©thodes de service qui modifient la base de donnÃ©es</li>
<li>Pensez Ã  ajouter <code>@Produces(MediaType.APPLICATION_JSON)</code> et <code>@Consumes(MediaType.APPLICATION_JSON)</code> sur vos resources</li>
</ul>
</blockquote>
<hr>
<p><em>Bon courage les M2 ! ğŸ¯</em></p>

		</body>